<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/gijgo@1.9.14/js/gijgo.min.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/gijgo@1.9.14/js/messages/messages.es-es.js" type="text/javascript"></script>
    <link href="https://cdn.jsdelivr.net/npm/gijgo@1.9.14/css/gijgo.min.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg bg-success">
        <div class="container-fluid">
            <div class="d-flex">
                <a class="navbar-brand text-white" href="#">EduPlanner</a>               
            </div>          
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav">
               <a class="nav-link active text-white" aria-current="page" href="{% url 'inicio' %}">Pagina Principal</a>   
               {% if request.user.is_authenticated %} 
                  {% if request.user.is_superuser or request.user.groups.all.0.name == 'administrador academico' %} 
                     <a href="{% url 'Panel Admin' %}" class="nav-link text-white">Agregar Evento</a>  
                     <a href="{% url 'Modificar evento' %}" class="nav-link text-white">Modificar Evento</a> 
                  {% endif %}                                          
               {% else %}                          
               {%endif%}        
            </div>

            <div class="d-flex ms-auto">
              {% if request.user.is_authenticated %}                         
              {% else %}
              <a href="{% url 'Registrarse' %}" class="nav-link text-white">Registrarse</a>            
              {%endif%}

              {% if request.user.is_authenticated %}  
              <a href="{% url 'salir' %}" class="nav-link text-white ms-auto">Cerrar sesión</a>                       
              {% else %}
              <a href="{% url 'Iniciar Sesion' %}" class="nav-link text-white ms-3">Iniciar sesión</a>            
              {%endif%} 
            </div>         
          </div>
        </div>
    </nav>

    <div class="container">

        <div class="row">

            <div class="col-lg-6">
                <div class="row">

                    <div class="col-lg-12">
                        <h1>Modificar evento</h1>
                    </div>
                </div>

                <div class="row">

                    <div class="mb-5 row">
                        <label for="inputTitulo" class="col-sm-2 col-form-label">Titulo</label>
                        <div class="col-sm-10">
                          <input type="text" class="form-control" id="inputTitulo">
                        </div>
                      </div>
                    <div class="mb-5 row">
                        <label for="inputDescripcion" class="col-sm-2 col-form-label">Descripcion</label>
                        <div class="col-sm-10">
                          <input type="text" class="form-control" id="inputDescripcion">
                        </div>
                    </div>
                    <div class="row mb-5">
                        <label for="exampleDataList" class="form-label">Datalist example</label>
                        <input class="form-control" list="opcionesDataList" id="inputTipo" placeholder="Type to search...">
                        <datalist id="opcionesDataList">
                            <option value="San Francisco">
                            <option value="New York">
                            <option value="Seattle">
                            <option value="Los Angeles">
                            <option value="Chicago">
                        </datalist>

                    </div>
                    
                    <div class="row mb-5">

                        <div class="col-lg-6">
                            <input id="datepicker1" width="276" />
                            <script>
                                $('#datepicker1').datepicker({ uiLibrary: 'bootstrap5', locale: 'es-es', });
                            </script>
                        </div>
                        
                        <div class="col-lg-6">
                            <input id="datepicker" width="276" />
                            <script>
                                $('#datepicker').datepicker({ uiLibrary: 'bootstrap5', locale: 'es-es', format: 'yyyy/mm/dd'});
                            </script>

                        </div>

                    </div>

                    <div class="row">

                        <div class="col-lg-6"><button class="btn btn-primary" type="submit">Actualizar evento</button></div>
                        <div class="col-lg-6"><button class="btn btn-danger" type="submit">Eliminar evento</button></div>

                    </div>

                      

                </div>
                
            </div>
            <div class="col-lg-6"> <!--Aqui deberia ir el calendario-->
                <div id="calendar"></div>
            </div>

        </div>

    </div>

    <!-- FullCalendar JS -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    <!-- JQuery (requerido por FullCalendar) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',  // Vista inicial del calendario (mes)
            locale: 'es',  // Configurar el idioma en español
            events: function(fetchInfo, successCallback, failureCallback) {
                $.ajax({
                    url: '/api/eventos/',  // URL de la API para obtener los eventos
                    method: 'GET',
                    success: function(data) {
                        var events = data.map(function(event) {
                            return {
                                title: event.titulo,  // Título del evento
                                start: event.fecha_inicio,  // Fecha de inicio
                                end: event.fecha_finalizacion, // Fecha de finalización
                                description: event.descripcion,
                                tipo: event.tipo
                                
                            };
                        });
                        successCallback(events);  // Retornar los eventos al calendario
                    },
                    error: function(xhr, status, error) {
                        console.log("Error al obtener los eventos:", error);
                        failureCallback();  // Si ocurre un error, notificar
                    }
                });
            },
            headerToolbar: {
                left: 'prev,next today',  // Botones para cambiar de mes
                center: 'title',  // Título del mes actual
                right: 'dayGridMonth,timeGridWeek,timeGridDay'  // Opciones para cambiar la vista
            },
            eventClick: function(info) {
                // Cuando un evento es clickeado, rellenamos los campos del formulario
                $('#inputTitulo').val(info.event.title);
                $('#inputDescripcion').val(info.event.extendedProps.description);
                $('#datepicker1').val(info.event.start.toLocaleDateString());
                $('#datepicker').val(info.event.end ? info.event.end.toLocaleDateString() : '');
                $('#inputTipo').val(info.event.extendedProps.tipo);
            }
        });

        calendar.render();  // Renderizar el calendario
    </script>
    
</body>
</html>
